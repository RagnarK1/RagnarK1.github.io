(function(){"use strict";var t={4889:function(t,e,a){var r=a(6040),n=a(7661);const o={id:"app"};function i(t,e,a,r,i,s){const l=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(l)])}var s=a(6691),l=a(929),d=a(6864),u=a(3594),c=a(4047);const h=(0,l.L)({uri:"https://01.kood.tech/api/graphql-engine/v1/graphql"}),p=(0,c.v)(((t,{headers:e})=>{const a=localStorage.getItem("jwt");return{headers:{...e,authorization:a?`Bearer ${a}`:""}}})),g=new d.f({link:p.concat(h),cache:new u.h}),f=(0,r.ri)({});f.provide(s.Gk,g);var v=g,m={setup(){return(0,n.JJ)(s.Gk,v),{}}},w=a(4309);const D=(0,w.Z)(m,[["render",i]]);var y=D,x=a(2029);const b=t=>((0,n.dD)("data-v-59baa637"),t=t(),(0,n.Cn)(),t),_={class:"login-form"},k=b((()=>(0,n._)("h2",null,"Login",-1))),A={class:"form-group"},C=b((()=>(0,n._)("label",{for:"username"},"Username:",-1))),R={class:"form-group"},$=b((()=>(0,n._)("label",{for:"password"},"Password:",-1))),O=b((()=>(0,n._)("button",{type:"submit"},"Login",-1)));function F(t,e,a,o,i,s){return(0,n.wg)(),(0,n.iD)("div",_,[k,(0,n._)("form",{onSubmit:e[2]||(e[2]=(0,r.iM)(((...t)=>s.login&&s.login(...t)),["prevent"]))},[(0,n._)("div",A,[C,(0,n.wy)((0,n._)("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>i.username=t),required:""},null,512),[[r.nr,i.username]])]),(0,n._)("div",R,[$,(0,n.wy)((0,n._)("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>i.password=t),required:""},null,512),[[r.nr,i.password]])]),O],32)])}a(3429),a(560);var S=a(4939),j={name:"LoginView",data(){return{username:"",password:""}},methods:{async login(){const t=this.username,e=this.password,a=`${t}:${e}`,r=btoa(a),n={Authorization:`Basic ${r}`,"Content-Type":"application/json"};S.Z.post("https://01.kood.tech/api/auth/signin",{},{headers:n}).then((t=>{console.log("Response:",t),200===t.status?(localStorage.setItem("jwt",t.data),console.log("Navigating to /profile..."),this.$router.push("/profile")):console.error("Login failed:","Invalid credentials")})).catch((t=>{console.error("Login failed:",t)}))}}};const q=(0,w.Z)(j,[["render",F],["__scopeId","data-v-59baa637"]]);var L=q,z=a(3839);const B=t=>((0,n.dD)("data-v-feaccfb0"),t=t(),(0,n.Cn)(),t),P={class:"profile"},M={class:"user-info"},U=B((()=>(0,n._)("h2",null,"User Profile",-1))),I={key:0},N={key:1},X={key:2},Z={key:3},J={key:4},T={class:"audits-section"},V={class:"mt2-01 flexColumn-01"},Y=B((()=>(0,n._)("div",{class:"mb3-01 fs4-01"},"Audits",-1))),G={key:0,class:"fs4-01 fMono-01"},K={key:1,class:"fs4-01 fMono-01"},W={key:2,class:"grey4-01"},E={class:"graphs"},H=B((()=>(0,n._)("h2",null,"XP progression",-1))),Q={class:"graph",width:"600",height:"300",ref:"xpChart"},tt={class:"audit-ratio-graph"},et=B((()=>(0,n._)("h2",null,"Audit Ratio",-1))),at={class:"audit-ratio-values"},rt={class:"audit-ratio-ratio"},nt={class:"graph",width:"800",height:"400",ref:"auditRatioChart"},ot=B((()=>(0,n._)("div",{class:"audit-ratio-done"},"Done",-1))),it={class:"audit-ratio-value"},st=B((()=>(0,n._)("div",{class:"audit-ratio-received"},"Received",-1))),lt={class:"audit-ratio-value"};function dt(t,e,a,r,o,i){return(0,n.wg)(),(0,n.iD)("div",P,[(0,n._)("div",M,[(0,n._)("button",{onClick:e[0]||(e[0]=(...t)=>i.logout&&i.logout(...t))},"Logout"),U,o.responseData&&o.responseData.data.user.length>0?((0,n.wg)(),(0,n.iD)("p",I,"Username: "+(0,z.zw)(o.responseData.data.user[0].login),1)):(0,n.kq)("",!0),null!==o.xpAmount?((0,n.wg)(),(0,n.iD)("p",N,"XP Amount: "+(0,z.zw)((o.xpAmount/1e3).toFixed(0))+" KB",1)):((0,n.wg)(),(0,n.iD)("p",X,"XP Amount: N/A")),o.loading?((0,n.wg)(),(0,n.iD)("p",Z,"Loading...")):(0,n.kq)("",!0),o.error?((0,n.wg)(),(0,n.iD)("p",J,(0,z.zw)(o.error.message),1)):(0,n.kq)("",!0)]),(0,n._)("div",T,[(0,n._)("div",V,[Y,o.hasAudits?((0,n.wg)(),(0,n.iD)("div",G,"There are audits to do.")):((0,n.wg)(),(0,n.iD)("div",K,"No audit to do, you're good!")),o.hasAudits?((0,n.wg)(),(0,n.iD)("div",W)):(0,n.kq)("",!0)])]),(0,n._)("div",E,[H,((0,n.wg)(),(0,n.iD)("svg",Q,null,512))]),(0,n._)("div",tt,[et,(0,n._)("div",at,[(0,n._)("div",rt,(0,z.zw)(i.auditRatio.toFixed(1)),1)]),((0,n.wg)(),(0,n.iD)("svg",nt,null,512)),ot,(0,n._)("div",it,(0,z.zw)((Math.floor(o.auditsDone/1e6*100)/100).toFixed(2))+" MB",1),st,(0,n._)("div",lt,(0,z.zw)((Math.ceil(o.auditsReceived/1e6*100)/100).toFixed(2))+" MB",1)])])}var ut=a(9031),ct={name:"ProfileView",data(){return{responseData:null,loading:!1,error:null,xpAmount:null,hasAudits:!1,lineChartData:[],xScale:null,yScale:null,auditsReceived:null,auditsDone:null}},computed:{auditRatio(){if(this.responseData&&this.responseData.data&&this.responseData.data.user&&this.responseData.data.user.length>0){const t=this.responseData.data.user[0],e=t.totalUp||0,a=t.totalDown||0,r=e/a;return isNaN(r)?0:r}return 0}},methods:{fetchData(){this.loading=!0;const t=localStorage.getItem("jwt");S.Z.post("https://01.kood.tech/api/graphql-engine/v1/graphql",JSON.stringify({query:'\n            {\n              user {\n                id\n                login\n                attrs\n                totalUp\n                totalDown\n                createdAt\n                updatedAt\n                transactions(where: {\n                  _and: [\n                    { type: { _iregex: "xp|level" } }\n                    { path: { _iregex: "div-01" } }\n                    { path: { _niregex: "piscine" } }\n                  ]\n                }, order_by: { createdAt: asc }) {\n                  id\n                  userId\n                  type\n                  amount\n                  createdAt\n                  path\n                }\n              }\n            }'}),{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then((t=>{if(this.responseData=t.data,this.responseData&&this.responseData.data.user.length>0){const t=this.responseData.data.user[0];this.xpAmount=t.transactions.filter((t=>"xp"===t.type)).reduce(((t,e)=>t+e.amount),0),this.lineChartData=this.formatDataForChart(t.transactions),this.auditsReceived=t.totalDown||0,this.auditsDone=t.totalUp||0}})).catch((t=>{this.error=t})).finally((()=>{this.loading=!1,this.generateXPChart(),this.generateAuditRatioChart()})),this.responseData&&this.responseData.data.user.length>0&&this.responseData.data.user[0].audits&&this.responseData.data.user[0].audits.length>0?this.hasAudits=!0:this.hasAudits=!1},formatDataForChart(t){let e=0;return t.filter((t=>"xp"===t.type)).map((t=>(e+=parseFloat(t.amount),{date:new Date(t.createdAt),xp:e})))},generateXPChart(){if(!this.lineChartData.length)return;const t={top:40,right:20,bottom:30,left:40},e=800-t.left-t.right,a=400-t.top-t.bottom,r=ut.Ys(this.$refs.xpChart);r.selectAll("g").remove(),r.append("g").attr("transform",`translate(${t.left},${t.top})`),this.xScale=ut.Xf().domain(ut.Wem(this.lineChartData,(t=>t.date))).range([0,e]),this.yScale=ut.BYU().domain([0,ut.Fp7(this.lineChartData,(t=>t.xp/1024))]).nice().range([a,0]);const n=ut.jvg().x((t=>this.xScale(t.date))).y((t=>this.yScale(t.xp/1024)));r.attr("width",e+t.left+t.right).attr("height",a+t.top+t.bottom).append("g").attr("transform",`translate(${t.left},${t.top})`);const o=ut.LLu(this.xScale);o.tickFormat(ut.i$Z("%b %Y"));const i=ut.y4O(this.yScale).tickValues([100,200,300,400,500]).tickFormat((t=>t+" KB"));i.tickFormat((t=>t+" MB")),r.append("path").datum(this.lineChartData).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",2).attr("d",n),r.append("g").attr("class","x-axis").attr("transform",`translate(0, ${a})`).call(o),r.append("g").attr("class","y-axis").call(i).selectAll("text").style("text-anchor","end").style("font-weight","bold").attr("dx","-0.5em").attr("dy","0.15em")},formatAuditRatioData(t){return t?t.map((t=>({timestamp:new Date(t.timestamp),ratio:t.completed/t.total}))):[]},generateAuditRatioChart(){if(!this.auditsReceived)return;const t={top:40,right:20,bottom:30,left:40},e=800-t.left-t.right,a=400-t.top-t.bottom,r=ut.Ys(this.$refs.auditRatioChart);r.selectAll("*").remove();const n=ut.tiA().domain(["Done","Received"]).range([0,e]).padding(.2),o=ut.BYU().domain([0,ut.Fp7([this.auditsDone,this.auditsReceived])]).nice().range([a,0]);r.attr("width",e+t.left+t.right).attr("height",a+t.top+t.bottom).append("g").attr("transform",`translate(${t.left},${t.top})`);const i=ut.LLu(n);r.append("g").attr("class","x-axis").attr("transform",`translate(0, ${a})`).call(i),r.append("g").attr("class","y-axis").call(ut.y4O(o));const s=[{category:"Done",value:this.auditsDone},{category:"Received",value:this.auditsReceived}];r.selectAll("rect").data(s).enter().append("rect").attr("x",(t=>n(t.category))).attr("y",(t=>o(t.value))).attr("width",n.bandwidth()).attr("height",(t=>a-o(t.value))).attr("fill","steelblue"),r.selectAll("text").data(s).enter().append("text").text((t=>t.value+" MB")).attr("x",(t=>n(t.category)+n.bandwidth()/2)).attr("y",(t=>o(t.value)-10)).attr("text-anchor","middle").attr("font-size","14px").attr("fill","white");const l="Ratio: "+(this.auditsDone/this.auditsReceived).toFixed(1);r.append("text").text(l).attr("x",e/2).attr("y",a+t.bottom).attr("text-anchor","middle").attr("font-size","16px").attr("fill","white")},logout(){localStorage.removeItem("jwt"),this.$router.push("/")}},mounted(){this.fetchData()}};const ht=(0,w.Z)(ct,[["render",dt],["__scopeId","data-v-feaccfb0"]]);var pt=ht;const gt=[{path:"/",name:"login",component:L},{path:"/profile",name:"profile",component:pt}],ft=(0,x.p7)({history:(0,x.PO)("/RagnarK1.github.io/"),routes:gt});var vt=ft;const mt=(0,r.ri)(y);mt.use(vt),(0,n.JJ)(s.Gk,v),mt.mount("#app")}},e={};function a(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,a),o.exports}a.m=t,function(){var t=[];a.O=function(e,r,n,o){if(!r){var i=1/0;for(u=0;u<t.length;u++){r=t[u][0],n=t[u][1],o=t[u][2];for(var s=!0,l=0;l<r.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((function(t){return a.O[t](r[l])}))?r.splice(l--,1):(s=!1,o<i&&(i=o));if(s){t.splice(u--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[r,n,o]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,r){var n,o,i=r[0],s=r[1],l=r[2],d=0;if(i.some((function(e){return 0!==t[e]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(l)var u=l(a)}for(e&&e(r);d<i.length;d++)o=i[d],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(u)},r=self["webpackChunkgraphql"]=self["webpackChunkgraphql"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=a.O(void 0,[998],(function(){return a(4889)}));r=a.O(r)})();
//# sourceMappingURL=app.8273f91d.js.map